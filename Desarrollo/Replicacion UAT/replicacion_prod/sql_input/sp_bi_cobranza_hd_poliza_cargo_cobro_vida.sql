CREATE OR REPLACE PROCEDURE `iter-data-storage-pv-uat`.programs.sp_bi_cobranza_hd_poliza_cargo_cobro_vida()
BEGIN 

DECLARE v_fecha_dia DATE DEFAULT CURRENT_DATE("America/Lima");

DELETE FROM `iter-data-storage-pv-uat.goldenrecord_data.HD_POLIZA_CARGO_COBRO_VIDA`
 --WHERE TIPO_PERIODO='RECAUDACION'
  WHERE FECHA_DIA = v_fecha_dia;
  
INSERT INTO `iter-data-storage-pv-uat.goldenrecord_data.HD_POLIZA_CARGO_COBRO_VIDA`
(
 FECHA_DIA
,PERIODO
,NUMERO_POLIZA
,ESTADO_POLIZA
,FECHA_BAJA
,COD_AGENTE_INICIAL
,COD_AGENTE_FINAL
,NOMBRE_PRODUCTO
,NOMBRE_GRUPO_PRODUCTO
,FECHA_EMISION
,NOMBRES_CONTRATANTE
,FECHA_NACIMIENTO_CONTRATANTE
,NUMERO_DOCUMENTO_CONTRATANTE
,COD_AGENCIA_FINAL
,COD_USERNAME_AGENTE
,NOMBRE_AGENTE_FINAL
,MONEDA_PRIMA_NETA
,PRIMA_NETA
,FRECUENCIA_PAGO
,NOMBRES_ASEGURADO
,NUMERO_DOCUMENTO_ASEGURADO
,TIPO_DOCUMENTO_ASEGURADO
,CANAL
,FECHA_INICIO_VIGENCIA_POLIZA
,FECHA_FIN_VIGENCIA_POLIZA
,ANTIGUEDAD
,TIPO_PERIODO
,NUMERO_CARGO
,ID_DEVOLUCION
,NUMERO_ABONO
,CARGO_FECHA_COBERTURA_INICIO
,FECHA_VENCIMIENTO_CUOTA
,FECHA_APLICADO_CARGO_ABONO
,FECHA_DEVOLUCION
,FECHA_REGISTRO_CAJA_PERU
,MONTO_CANTIDAD_ABONO_PEN
,MONTO_CANTIDAD_ABONO_USD
,MONTO_POR_COBRAR_PEN
,MONTO_POR_COBRAR_USD
,NUMERO_VIA_PAGO
,MONTO_DEVOLUCION_PEN_PERIODO
,MONTO_DEVOLUCION_USD_PERIODO
,CONCEPTO_CARGO
,ESTADO_CARGO
,ESTADO_ABONO
,FLAG_DEVOLUCION_PERIODO
,NUMERO_POLIZA_INT
,DIAS_IMPAGO
,SALDO_CANTIDAD_PEN
,SALDO_CANTIDAD_USD
,VIA_COBRO
,ID_CARGO
,MONTO_TIPO_CAMBIO
,PERIODO_DIA_INICIO_4M
,PERIODO_DESCRIPCION_ABREVIADO
,PERIODO_FECHA_INICIO
,PERIODO_FECHA_FIN
,PERIODO_RECAUDACION_DIA_INICIO
,PERIODO_RECAUDACION_DIA_FIN
,CARGO_FECHA_COBERTURA_FIN
,CONCEPTO_CARGO_TIPO_INGRESO
,MONTO_CARGO_MONEDA
,MONTO_CARGO_CANTIDAD_PEN
,MONTO_CARGO_CANTIDAD_USD
,CARGO_PERIODO_COBRANZA
,MOTIVO_RECHAZO
,TIPO_TARJETA_AFILIADO
,NUMERO_TARJETA
,OPERADOR_AFILIADO
,PASARELA
,PUNTAJE_SEGMENTO
,SEGMENTO
,CORREO_CONTRATANTE
,CELULAR_CONTRATANTE
,ID_PERSONA
,CODIGO_JEFE
,NOMBRE_JEFE
,NOMBRE_SUPERVISOR
,FECHA_PAGADO_HASTA
,TIPO_DOCUMENTO_CONTRATANTE
,RAZON_SOCIAL_CONTRATANTE
,NOMBRE_CONTRATANTE
,APELLIDO_PATERNO_CONTRATANTE
,APELLIDO_MATERNO_CONTRATANTE
,TELEFONO
,CORREO_AGENTE_FINAL
,CODIGO_CONTRATO
,ID_PRODUCTO
,PERFIL_FINANCIERO
,TIPO_MONEDA_TC_PERFIL
,MORA
,EMISOR
,TIPO_TARJETA
,CORREO_ULT
,FECHA_NACIMIENTO_ASEGURADO
)
SELECT 
 CURRENT_DATE("America/Lima") AS FECHA_DIA
,PERIODO
,NUMERO_POLIZA
,ESTADO_POLIZA
,FECHA_BAJA
,COD_AGENTE_INICIAL
,COD_AGENTE_FINAL
,NOMBRE_PRODUCTO
,NOMBRE_GRUPO_PRODUCTO
,FECHA_EMISION
,NOMBRES_CONTRATANTE
,FECHA_NACIMIENTO_CONTRATANTE
,NUMERO_DOCUMENTO_CONTRATANTE
,COD_AGENCIA_FINAL
,COD_USERNAME_AGENTE
,NOMBRE_AGENTE_FINAL
,MONEDA_PRIMA_NETA
,PRIMA_NETA
,FRECUENCIA_PAGO
,NOMBRES_ASEGURADO
,NUMERO_DOCUMENTO_ASEGURADO
,TIPO_DOCUMENTO_ASEGURADO
,CANAL
,FECHA_INICIO_VIGENCIA_POLIZA
,FECHA_FIN_VIGENCIA_POLIZA
,ANTIGUEDAD
,TIPO_PERIODO
,NUMERO_CARGO
,ID_DEVOLUCION
,NUMERO_ABONO
,CARGO_FECHA_COBERTURA_INICIO
,FECHA_VENCIMIENTO_CUOTA
,FECHA_APLICADO_CARGO_ABONO
,FECHA_DEVOLUCION
,FECHA_REGISTRO_CAJA_PERU
,MONTO_CANTIDAD_ABONO_PEN
,MONTO_CANTIDAD_ABONO_USD
,MONTO_POR_COBRAR_PEN
,MONTO_POR_COBRAR_USD
,NUMERO_VIA_PAGO
,MONTO_DEVOLUCION_PEN_PERIODO
,MONTO_DEVOLUCION_USD_PERIODO
,CONCEPTO_CARGO
,ESTADO_CARGO
,ESTADO_ABONO
,FLAG_DEVOLUCION_PERIODO
,NUMERO_POLIZA_INT
,DIAS_IMPAGO
,SALDO_CANTIDAD_PEN
,SALDO_CANTIDAD_USD
,VIA_COBRO
,ID_CARGO
,MONTO_TIPO_CAMBIO
,PERIODO_DIA_INICIO_4M
,PERIODO_DESCRIPCION_ABREVIADO
,PERIODO_FECHA_INICIO
,PERIODO_FECHA_FIN
,PERIODO_RECAUDACION_DIA_INICIO
,PERIODO_RECAUDACION_DIA_FIN
,CARGO_FECHA_COBERTURA_FIN
,CONCEPTO_CARGO_TIPO_INGRESO
,MONTO_CARGO_MONEDA
,MONTO_CARGO_CANTIDAD_PEN
,MONTO_CARGO_CANTIDAD_USD
,CARGO_PERIODO_COBRANZA
,MOTIVO_RECHAZO
,TIPO_TARJETA_AFILIADO
,NUMERO_TARJETA
,OPERADOR_AFILIADO
,PASARELA
,PUNTAJE_SEGMENTO
,SEGMENTO
,CORREO_CONTRATANTE
,CELULAR_CONTRATANTE
,ID_PERSONA
,CODIGO_JEFE
,NOMBRE_JEFE
,NOMBRE_SUPERVISOR
,FECHA_PAGADO_HASTA
,TIPO_DOCUMENTO_CONTRATANTE
,RAZON_SOCIAL_CONTRATANTE
,NOMBRE_CONTRATANTE
,APELLIDO_PATERNO_CONTRATANTE
,APELLIDO_MATERNO_CONTRATANTE
,TELEFONO
,CORREO_AGENTE_FINAL
,CODIGO_CONTRATO
,ID_PRODUCTO
,PERFIL_FINANCIERO
,TIPO_MONEDA_TC_PERFIL
,MORA
,EMISOR
,TIPO_TARJETA
,CORREO_ULT
,FECHA_NACIMIENTO_ASEGURADO
FROM `iter-data-storage-pv-uat.goldenrecord_data.HM_POLIZA_CARGO_VIDA`
WHERE PERIODO = (SELECT MAX(PERIODO) FROM `iter-data-storage-pv-uat.goldenrecord_data.HM_POLIZA_CARGO_VIDA`)
;


END;